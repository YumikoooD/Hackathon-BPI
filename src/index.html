<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="./assets/icon.png" rel="icon" type="image/x-icon">
  <link href="./css/style.css" rel="stylesheet">
  <title>Entretien</title>
</head>
<body>
  <div id="video" class="video"></div>
  <div class="chat">
    <!-- <p class="left-msg">This is a message</p>
    <p class="right-msg">This is an other message</p> -->
  </div>
</body>
<script>
  (function (window) {
    const host = "https://labs.heygen.com";
    const url =
      host +
      "/guest/streaming-embed?share=eyJxdWFsaXR5IjoiaGlnaCIsImF2YXRhck5hbWUiOiJlZjA4MDM5YTQxMzU0ZWQ1YTIwNTY1ZGI4%0D%0AOTkzNzNmMyIsInByZXZpZXdJbWciOiJodHRwczovL2ZpbGVzMi5oZXlnZW4uYWkvYXZhdGFyL3Yz%0D%0AL2VmMDgwMzlhNDEzNTRlZDVhMjA1NjVkYjg5OTM3M2YzL2Z1bGwvMi4yL3ByZXZpZXdfdGFyZ2V0%0D%0ALndlYnAiLCJuZWVkUmVtb3ZlQmFja2dyb3VuZCI6ZmFsc2UsImtub3dsZWRnZUJhc2VJZCI6IjM1%0D%0AM2EzMDRhZDNlZjQ1NmZiNzk1ZWY0MDkyZDgyMjZlIiwidXNlcm5hbWUiOiI3MjQ5ZmU0MTdiNGQ0%0D%0AODM3ODVkMmZlNmQ2MzBhYjdiZCJ9&inIFrame=1";

    const clientWidth = document.body.clientWidth;

    // Create the main wrapper div
    const wrapDiv = document.createElement("div");
    wrapDiv.id = "heygen-streaming-embed";

    // Create the container for the iframe
    const container = document.createElement("div");
    container.id = "heygen-streaming-container";

    // Add custom styles
    const stylesheet = document.createElement("style");
    stylesheet.innerHTML = `
      #heygen-streaming-embed {
        margin: 100px auto;
        width: 80%;
        height: 80%;
        border-radius: 5%;
        border: none;
        box-shadow: none;
        transition: all linear 0.1s;
        overflow: hidden;
        opacity: 1;
        visibility: visible;
      }

      #heygen-streaming-embed.show {
        opacity: 1;
        visibility: visible;
      }

      #heygen-streaming-embed.expand {
        width: 40vw;
        height: 80vh;
      }

      #heygen-streaming-container {
        width: 100%;
        height: 100%;
      }

      #heygen-streaming-container iframe {
        width: 100%;
        height: 100%;
        border: 0;
      }
    `;

    // Create the iframe element
    const iframe = document.createElement("iframe");
    iframe.allowFullscreen = false;
    iframe.title = "Streaming Embed";
    iframe.role = "dialog";
    iframe.allow = "microphone";
    iframe.src = url;

    let visible = false;
    let initial = false;

    // Listen for messages from the iframe
    window.addEventListener("message", (e) => {
      if (e.origin === host && e.data && e.data.type === "streaming-embed") {
        switch (e.data.action) {
          case "init":
            initial = true;
            wrapDiv.classList.toggle("show", initial);
            break;
          case "show":
            visible = true;
            wrapDiv.classList.toggle("expand", visible);
            break;
          case "hide":
            visible = false;
            wrapDiv.classList.toggle("expand", visible);
            break;
        }
      }
    });

    // Append elements to the DOM
    container.appendChild(iframe);
    wrapDiv.appendChild(stylesheet);
    wrapDiv.appendChild(container);
    const videoDiv = document.getElementById("video");
    videoDiv.appendChild(wrapDiv);
  })(globalThis);
</script>
</html>
